> WIP!

# Terragrunt + GitLabhq/gitlab Provider Example

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Terragrunt –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ GitLab (–≥—Ä—É–ø–ø–∞–º–∏, –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏) —á–µ—Ä–µ–∑ Terraform-–º–æ–¥—É–ª–∏.

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ


- **–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã** (`gitlab-group`): –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –≤ GitLab —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π CI/CD-–ø–µ—Ä–µ–º–µ–Ω–Ω—ãx –≥—Ä—É–ø–ø—ã.  
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–µ–∫—Ä–µ—Ç–æ–≤** (`secrets-generator`): –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∏—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ CI/CD-–ø–µ—Ä–µ–º–µ–Ω–Ω—ãx –≥—Ä—É–ø–ø—ã.  
- **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤** (`gitlab-project`): —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Ç–æ–∫, protection rules.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Terragrunt —Å–æ–±—Ä–∞–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `gitlab/App-1`, –≥–¥–µ:

1. **`terragrunt.hcl`** —Å–æ–∑–¥–∞—ë—Ç –≥—Ä—É–ø–ø—É `App-1` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤.  
2. –í –ø–æ–¥–ø–∞–ø–∫–∞—Ö `projects/backend` –∏ `projects/frontend` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–≤—É—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã.  

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```plain
.
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ clean_terraform.sh      # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ Terraform
‚îú‚îÄ‚îÄ root.hcl                # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Terragrunt (remote state + –æ–±—â–∏–µ inputs)
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ gitlab-group/       # –ú–æ–¥—É–ª—å Terraform –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è GitLab-–≥—Ä—É–ø–ø—ã + –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ provider.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ variables.tf
‚îÇ   ‚îú‚îÄ‚îÄ secrets-generator/  # –ú–æ–¥—É–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ provider.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ variables.tf
‚îÇ   ‚îî‚îÄ‚îÄ gitlab-project/     # –ú–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è GitLab-–ø—Ä–æ–µ–∫—Ç–∞ + protection rules
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ provider.tf
‚îÇ       ‚îî‚îÄ‚îÄ variables.tf
‚îî‚îÄ‚îÄ gitlab/
    ‚îî‚îÄ‚îÄ App-1/
        ‚îú‚îÄ‚îÄ terragrunt.hcl               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã App-1
        ‚îú‚îÄ‚îÄ outputs.tf                   # –í—ã–≤–æ–¥—ã –≥—Ä—É–ø–ø—ã (ID, URL, —Ç–æ–∫–µ–Ω—ã)
        ‚îú‚îÄ‚îÄ secrets/                     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã
        ‚îÇ   ‚îú‚îÄ‚îÄ terragrunt.hcl
        ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
        ‚îî‚îÄ‚îÄ projects/
            ‚îú‚îÄ‚îÄ backend/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ backend
            ‚îÇ   ‚îú‚îÄ‚îÄ terragrunt.hcl
            ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf
            ‚îî‚îÄ‚îÄ frontend/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ frontend
                ‚îú‚îÄ‚îÄ terragrunt.hcl
                ‚îî‚îÄ‚îÄ outputs.tf
```

---

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
export GITLAB_API_TOKEN="your_personal_access_token"
export GITLAB_API_URL="https://gitlab.com/api/v4/"
```
> –í–∞–∂–Ω–æ: —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤.

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–µ–≥–æ:

```bash
git clone https://github.com/nasmolin/terragrunt-gitlab-example.git
cd terragrunt-gitlab-example
```

```bash
terragrunt plan -all
terragrunt apply -all
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
* –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –≥—Ä—É–ø–ø–∞ App-1
* –ó–∞—Ç–µ–º ‚Äî –¥–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞ backend –∏ frontend –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë
* –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ `gitlab/App-1/secrets/terragrunt.hcl` —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞–¥—É—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã

---

## ‚öôÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π
`modules/gitlab-group`
–°–æ–∑–¥–∞—ë—Ç —Ä–µ—Å—É—Ä—Å gitlab_group —Å –Ω–∞–±–æ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (gitlab_group_variable).

`modules/secrets-generator`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (random_password) –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ generate_secrets.

`modules/gitlab-project`
–°–æ–∑–¥–∞—ë—Ç —Ä–µ—Å—É—Ä—Å gitlab_project, –≤–µ—Ç–∫–∏ (gitlab_branch), protection rules (gitlab_branch_protection, gitlab_tag_protection) –∏ CI/CD-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (gitlab_project_variable).

---